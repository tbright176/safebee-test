{% extends 'base.html' %}
{% load paginate recall_tags %}

{% block extra_meta %}
<meta name="ROBOTS" content="NOINDEX">
{% endblock %}

{% block extra_js_bottom %}
  <script>
  /**
   * http://stackoverflow.com/a/10997390/11236
   */

function getURLParameter(variable, fallback)
{
  var query = window.location.search.substring(1);
  var vars = query.split("&");
  for (var i=0;i<vars.length;i++) {
    var pair = vars[i].split("=");
    if(pair[0] == variable){return pair[1];}
  }
  return(fallback);
}

function updateURLParameter(url, param, paramVal){
  var newAdditionalURL = "";
  var tempArray = url.split("?");
  var baseURL = tempArray[0];
  var additionalURL = tempArray[1];
  var temp = "";
  if (additionalURL) {
    tempArray = additionalURL.split("&");
    for (i=0; i<tempArray.length; i++){
      if(tempArray[i].split('=')[0] != param){
        newAdditionalURL += temp + tempArray[i];
        temp = "&";
      }
    }
  }

  var rows_txt = temp + "" + param + "=" + paramVal;
  return baseURL + "?" + newAdditionalURL + rows_txt;
}

$(function() {
  $('#sort-by').val(getURLParameter('sort', 'latest'));
  $('#sort-by').on('change',function() {
    window.location.href = updateURLParameter(window.location.href, 'sort', $(this).val());
  });

  $('#pagination-length').val(getURLParameter('page_size', 15));
  $('#pagination-length').on('change',function() {
    window.location.href = updateURLParameter(window.location.href, 'page_size', $(this).val());
  });
});

</script>
{% endblock %}

{% block content %}
<div id="recall-content" class="row search-results">
  <div class="medium-9 columns breadcrumb show-for-medium-up">
    <a href="{% url 'recalls_home' %}">Recalls</a> &gt; {{ category_title }}
  </div>

  <div class="medium-9 columns">
    <div class="show-for-small-only right"><a href="{% url 'recalls_signup' %}"><img class="mobile-sign-up" src="{{ STATIC_URL }}recalls/header-recall-alert-signup-mobile.png" /></a></div>
    <h2 class="page-header">{{ category_title }} <img class="header-icon" src="{{ STATIC_URL }}recalls/icon-exclamation.png" /><span class="right show-for-medium-up"><a href="{% url 'recalls_signup' %}"><img class="sign-up" src="{{ STATIC_URL }}recalls/header-recall-alert-signup.png" /></a></span></h2>
    <div class="row">
      <div class="small-12 columns">
        <div class="search-results-header">
          <h2>{{ list_title }} {% if pagination_obj and not pagination_obj.number == 1 %} - Page {{ pagination_obj.number }}{% endif %}</h2>
          <div class="search-results-filter sort-by">
            <label for="sort-by">Sort By</label>
            <select id="sort-by">
              <option value="latest" selected="selected">Most Recent</option>
              <option value="oldest">Oldest</option>
            </select>
          </div>
          <div class="search-results-filter pagination-length">
            <label for="pagination-length">View</label>
            <select id="pagination-length">
              <option value="15" selected="selected">15 Per Page</option>
              <option value="45">45 Per Page</option>
              <option value="90">90 Per Page</option>
            </select>
          </div>

        </div><!-- end search-results-header -->
        <div id="search-results-list">
          <ul>
            {% for recall_item in object_list %}
            {% recall_obj recall_item as recall %}
            <li>
              <div class="search-result-image">
                <a href="{{ recall.get_absolute_url }}"><img data-interchange="[{{ recall.get_image_65 }}, (default)], [{{ recall.get_image_90 }}, (medium)]" /></a>
              </div>
              <div class="search-result-info">
                <p class="recall-meta show show-for-medium-up">Recall Date: {{ recall.recall_date }}</p>
                {% if recall.models %}
                <p class="recall-meta show show-for-medium-up">Makes(s) Affected: {{ recall.makes }}</p>
                <p class="recall-meta show show-for-medium-up">Model(s) Affected: {{ recall.models|truncatewords:"8" }}</p>
                {% endif %}
                <h3><a href="{{ recall.get_absolute_url }}">{% if recall.title %}{{ recall.title }}{% else %}{{ recall }}{% endif %}</a></h3>
                {% if recall.models %}
                <p class="recall-meta show show-for-medium-up">Year(s) Affected: {{ recall.years }}</p>
                {% endif %}
                <p class="recall-meta show show-for-medium-up">Recall number: {{ recall.recall_number }}</p>
              </div>
              <div class="search-result-detail show show-for-medium-up">
                <a href="{{ recall.get_absolute_url }}">View Details <i class="fa fa-angle-right fa-2x"></i></a>
              </div>
            </li>

            {% endfor %}
          </ul>
        </div><!-- end search-results-list -->
        <div class="row">
          <div class="small-11 small-centered medium-12 medium-uncentered columns">
            {% if page_obj %}{% paginate page_obj %}{% endif %}
          </div>
        </div>
      </div><!-- end small-12 columns -->
    </div><!-- end row -->

    {% include 'recalls/includes/latest_most_popular.html' %}

  </div><!-- end medium-9 -->

  {% include 'includes/content/sidebar.html' %}

</div><!-- end article content -->
{% endblock %}
