{% extends 'base.html' %}

{% block extra_js_bottom %}
<script src="{{ STATIC_URL }}js/vendor/select2.min.js"></script>
<script>

function json_to_select(url, select_selector) {
/*
 Fill a select input field with data from a getJSON call
 Inspired by: http://stackoverflow.com/questions/1388302/create-option-on-the-fly-with-jquery
*/
  $.getJSON(url, function(data) {
    var opt=$(select_selector);
    var old_val=opt.val();
    opt.html('');
    $.each(data, function () {
      opt.append($('<option/>').val(this.id).text(this.value));
    });
    opt.val(old_val);
    opt.change();
  })
}


$(function(){
});

$(document).ready(function() {

  $(".select2").select2();

  $('#id_vehicle_make').change(function(){
    json_to_select('{% url 'recalls_car_models' %}?make_id=' + $(this).val(), '#id_vehicle_model');
  });

  $('#id_vehicle_model').change(function(){
    json_to_select('{% url 'recalls_car_years' %}?model_id=' + $(this).val(), '#id_vehicle_year');
  });

});</script>
{% endblock %}

{% block extra_css_top %}
<link href="{{ STATIC_URL }}css/select2/select2.css" rel="stylesheet"/>
{% endblock %}

{% block notifications %}
{% if messages %}
{% for message in messages %}
<div data-alert class="alert-box {{ message.tags }}">
  {{ message }}
  <a href="#" class="close">&times;</a>
</div>
{% endfor %}
{% endif %}
{% endblock %}

{% block content %}
<div id="recall-content" class="row">
  <div class="medium-9 columns">
    <h2 class="page-header show-for-medium-up">Product Recalls <img class="header-icon" src="{{ STATIC_URL }}recalls/icon-exclamation.png" /></h2>
    <div class="row subscribe">
      <div class="medium-4 columns show-for-medium-up">
        <img src="{{ STATIC_URL }}recalls/subscribe_family_image.jpg" />
      </div>
      <div class="small-12 medium-8 columns">
        <h1>Sign Up for Recall &amp; Safety Alerts</h1>
        <p class="show-for-small-only"><img src="{{ STATIC_URL }}recalls/subscribe_family_image.jpg" /></p>
        <p>Receive recall and safety information alerts via email.</p>
        <p>After signing up, a confirmation email will be sent asking you to confirm your subscription. Your email address will not be shared with any 3rd parties and youâ€™ll only receive content from Safebee</p>

      </div>
      <form id="options-form" url="{% url 'recalls_signup' %}" method="post" data-abide>
        {% if form.non_field_errors %}
            <ul class="errorlist">
            {% for error in form.non_field_errors %}
                <li class="non-field-error"><i class="fa fa-times-circle"></i> {{ error|escape }}</li>
            {% endfor %}
            </ul>
        {% endif %}
        {% csrf_token %}
        <div class="medium-8 columns">
          <div id="subscribe-alert-box">
            <h3>Enter your email to receive a daily recalls newsletter</h3>
            <div class="input-container">
              <div class="small-12 medium-12 columns collapse-left collapse-right-mobile">
                {{ form.email.errors }}
                <input id="id_email" name="email" type="email" placeholder="Enter email address" />
                <small class="error"><i class="fa fa-times-circle"></i> Please enter a valid Email address.</small>
              </div>
            </div>
          </div>
        </div>
        <div class="small-12 columns" data-equalizer>
          <button type="submit">Subscribe <i class="fa fa-angle-right"></i></button>
        </div>
      </form>
    </div>

    {% include 'recalls/includes/latest_most_popular.html' %}

  </div><!-- end medium-9 -->

  {% include 'includes/content/sidebar.html' %}

</div><!-- end article content -->
{% endblock %}
