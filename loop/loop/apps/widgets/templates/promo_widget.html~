{% load thumbnail %}

{% if promo and promo_items %}
{% if promo.show_header %}<h2 class="section-header">{{ promo.label }}</h2>{% endif %}
<div id="featured-promo-module">
  <ul>
    {% for promo_item in promo_items %}
    {% with obj=promo_item.content_object auth_profile=promo_item.content_object.author.get_profile abs_url=promo_item.content_object.get_absolute_url %}
    <li>
        <p class="thumb {% cycle 'left' 'right' %}">
            <a href="{% if promo_item.link %}{{ promo_item.link }}{% else %}{{ abs_url }}{% endif %}" onClick="_gaq.push(['_trackEvent', 'Promo Widgets', '{{ promo.label|escape }}', 'Promo Image Click']);"><img src="{% if promo_item.image %}{% thumbnail promo_item.image.asset "98x98" crop="center" %}{% else %}{% thumbnail obj.promo_image.asset "98x98" crop="center" %}{% endif %}" /></a>
        </p>
        <h3><a href="{{ abs_url }}" onClick="_gaq.push(['_trackEvent', 'Promo Widgets', '{{ promo.label|escape }}', 'Promo Title Click']);">{% firstof promo_item.title obj.title %}</a></h3>
        <p class="excerpt">{% if promo_item.description %}{{ promo_item.description }}{% else %}{{ obj.description|truncatewords:13 }}{% endif %}</p>
        <p class="byline {% if auth_profile.image %} avatar{% endif %}"{% if auth_profile.image %} style="background-image: url({% thumbnail auth_profile.image "24x24" crop="smart" quality=100 %})"{% endif %}>
            by <a href="{{ abs_url }}">{{ obj.author.get_full_name }}</a> in {{ obj.category }}
        </p>
    </li>
    {% endwith %}
    {% endfor %}
  </ul>
</div>
{% endif %}
